<!DOCTYPE html><html><head>
		<title>Actually unmounting and removing power off HDDs</title>
		<meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="shortcut icon" href="assets/Crystal_Clear_app_tux.png" type="image/png">
		<link rel="stylesheet" href="main.css">


		<header>
			<div>
				<!-- 
					<a href="https://trevcan.github.io"> 
				-->
				<a href="index.html">

					<!--
						<h1>trevcan@internets /random/path/idk $</h1>
					-->
					<h1>trevcan@internets /dev/human $</h1>
				</a>
				<div class="header-links">
					<a href="index.html"><h2 class="header-link">Index</h2></a>
					<a href="about.html"><h2 class="header-link">About</h2></a>
					<a href="rss.xml"><h2 class="header-link">RSS</h2></a>
					<a href="atom.xml"><h2 class="header-link"> atom</h2></a>
					<a href="wl.html"><h2 class="header-link">later</h2></a>
				</div>
			</div>
		</header>


	</head><body>

		<div class="container">

	<h1>Actually unmounting and removing power off HDDs</h1>

	<table>
		<tr>
			<td><i>Posted on:</i></td>
			<td><i>03/30/2022 06:19:42 PM</i></td>

		</tr>
		<tr>
			<td><i>Last edited:</i></td>
			<td><i>03/30/2022 06:22:39 PM</i></td>
		</tr>
	</table>

<p>On windows 10, when ejecting a hard disk drive, it will stop
spinning. That is nice. It, of course, unmounts the partitions
before.</p>

<p>Linux does not do this automatically, at least not my minimalist
setup that only uses <code>dmenu</code>,<code>lsblk</code>,<code>mount</code>,<code>umount</code> and a little
of <code>grep</code>/<code>sed</code>/<code>other text-editing tools</code>.</p>

<p>When unmounting a drive using <code>umount</code> it merely unmounts the disk
partitions. It DOES NOT manage power, as far as I know.</p>

<p>To remove power from the HDD, I use a tool named <code>hdparm</code>, used to
set HDD parameters through the shell. The package should
be installed by default on
<a href="https://archlinux.org/packages/core/x86_64/hdparm/">archlinux</a>,
<a href="https://sourceforge.net/projects/hdparm/">this is the project page</a>
(it has adware).</p>

<p>Anyways, to set the HDD params you need to be root. I don&rsquo;t know how
to set the permissions so that a normal user can do this, but I&rsquo;m not
interested in learning how to do that cause if an attacker gains
command execution on my system I don&rsquo;t want them to have access to
managing my HDDs power.</p>

<p>I use this script:</p>

<p><pre><code>    timeout 10s prompt "Remove power from $1 ? " "sudo -A hdparm -Y $1" &amp;&amp;
    notify-send "$ dmenuumount" "Power removed from ${1}. You may disconnect it now."
</code></pre>
the important part is <code>hdparm -Y "$1"</code>. This flag <code>-Y</code> (yes, capital Y) means
put the device in the
lowest possible power mode. It will still be listed under <code>lsblk</code> but it will turn
on once you actually want to mount it. the <code>"$1"</code> is the path for the device, e.g.
<code>/dev/sde</code>.</p>

<p>As noted before, you must be root.
<strong>BE SURE to check the device, since running this </strong>
<strong>command on any devices you are using could fuck up the system!</strong></p>

<p>questions ? <a href="contact.html">contact</a> me.</p>

<i> Tags: <b> linux power devices </b></i>
</div>
<footer id=footer >

	<span>
		<!--
			<b>By trevcan : Hector Canizales;</b>
		-->
		<b>By trevcan : Hector Canizales;</b>
	</span>
	<a href="LICENSE">
		<span>© sometime to ∞</span>
	</a>
	<p>
	<span>
		<b>Powered by my </b>
	</span>
	<a href="https://github.com/trevcan/blogit">
		<span>fork of blogit</span>
	</a>
	<span>
		and tocttou's beautiful
	</span>
	<a href="https://github.com/tocttou/hacker-blog/blob/master/_sass/base.scss">
		<span>css</span>
	</a>


</footer>

</body></html>
